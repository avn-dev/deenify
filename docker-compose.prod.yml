services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    image: deenify-app:latest
    environment:
      APP_ENV: ${APP_ENV:-production}
      APP_DEBUG: ${APP_DEBUG:-false}
      APP_URL: ${APP_URL:-https://example.com}
      APP_NAME: ${APP_NAME:-Deenify}
      APP_KEY: ${APP_KEY:-}
      VIEW_COMPILED_PATH: /var/www/html/storage/framework/views
      LOG_CHANNEL: ${LOG_CHANNEL:-stderr}
      DB_CONNECTION: ${DB_CONNECTION:-mysql}
      DB_HOST: ${DB_HOST:-mysql}
      DB_PORT: ${DB_PORT:-3306}
      DB_DATABASE: ${DB_DATABASE:-deenify}
      DB_USERNAME: ${DB_USERNAME:-deenify}
      DB_PASSWORD: ${DB_PASSWORD:-change_me}
      SESSION_DRIVER: ${SESSION_DRIVER:-database}
      SESSION_LIFETIME: ${SESSION_LIFETIME:-43200}
      SESSION_EXPIRE_ON_CLOSE: ${SESSION_EXPIRE_ON_CLOSE:-false}
      SESSION_SECURE_COOKIE: ${SESSION_SECURE_COOKIE:-true}
      SESSION_SAME_SITE: ${SESSION_SAME_SITE:-lax}
      SESSION_DOMAIN: ${SESSION_DOMAIN:-.example.com}
      CACHE_DRIVER: ${CACHE_DRIVER:-database}
      QUEUE_CONNECTION: ${QUEUE_CONNECTION:-database}
      SANCTUM_STATEFUL_DOMAINS: ${SANCTUM_STATEFUL_DOMAINS:-example.com}
      FRONTEND_URLS: ${FRONTEND_URLS:-https://example.com}
    ports:
      - "9000:9000"
    depends_on:
      - mysql
    volumes:
      - app_storage:/var/www/html/storage
      - app_cache:/var/www/html/bootstrap/cache
      - ./public/build:/var/www/html/public/build
    restart: unless-stopped

  mysql:
    image: mysql:8.4
    environment:
      MYSQL_DATABASE: ${DB_DATABASE:-deenify}
      MYSQL_USER: ${DB_USERNAME:-deenify}
      MYSQL_PASSWORD: ${DB_PASSWORD:-change_me}
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD:-change_me_root}
    volumes:
      - mysql_data:/var/lib/mysql
    restart: unless-stopped

  phpmyadmin:
    image: phpmyadmin:5.2
    environment:
      PMA_HOST: mysql
      PMA_PORT: 3306
      PMA_ARBITRARY: 0
    ports:
      - "${PMA_PORT:-8080}:80"
    depends_on:
      - mysql
    restart: unless-stopped

volumes:
  mysql_data:
  app_storage:
  app_cache:
